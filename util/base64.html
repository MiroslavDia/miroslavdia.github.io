<!DOCTYPE html>
<html>
	<head>
		<title>Утилиты</title>
		<meta charset="UTF-8"></meta>
		<script>
			function _atob(str) {
				return decodeURIComponent(escape(window.atob(str)));
			}
			function _btoa(str) {
				return window.btoa(unescape(encodeURIComponent(str)));
			}
			function init() {
				var deftext = 'Hello, world!';
				document.getElementById("base64en").value = deftext;
				document.getElementById("base64de").value = btoa(deftext);
			}
			function getEnding() {
				var i = document.getElementById('end').selectedIndex;
				return i==0?'\n':(i==1?'\r\n':'\r');
			}
			function correctText(text) {
				return text.split('\n').join(getEnding());
			}
			function en64(text) {
				console.log('[Encode]' + JSON.stringify(text));
				var en;
				try {
					en = _btoa(text);
				}catch(ex){
					document.getElementById('msg').style.color = 'red';
					document.getElementById('msg').innerHTML = 'Ошибка';
					console.error('Исключение:');
					console.error('[В обычном виде] '+ex.toString());
					console.error('[Название]'+ex.name);
					return;
				}
				document.getElementById('msg').style.color = 'green';
				document.getElementById('msg').innerHTML = 'Успешно';
				document.getElementById("base64en").value = text;
				document.getElementById("base64de").value = en;
			}
			function de64(text) {
				console.log('[Decode]\'' + text + '\'');
				var de;
				try {
					de = _atob(text);
				}catch(ex){
					document.getElementById('msg').style.color = 'red';
					document.getElementById('msg').innerHTML = 'Ошибка';
					console.error('Исключение:');
					console.error('[В обычном виде] '+ex.toString());
					console.error('[Название]'+ex.name);
					return;
				}
				document.getElementById('msg').style.color = 'green';
				document.getElementById('msg').innerHTML = 'Успешно';
				document.getElementById("base64de").value = text;
				document.getElementById("base64en").value = atob(text);
			}
			function update() {
				en64(correctText(document.getElementById('base64en').value));
				de64(correctText(document.getElementById('base64de').value));
			}
		</script>
		<style>
			#base64en {
				width: 20%;
			}
			#base64de {
				width: 20%;
			}
			#msg {
				color: green;
			}
		
		</style>
	</head>
	<body onload="init();">
		<center>
		<h1>Base64</h1>
		Формат строк: <select onchange="update();" id="end">
			<option value="unix" selected>Unix (LF)</option>
			<option value="windows">Windows (CR LF)</option>
			<option value="macintosh">Macintosh (CR)</option>
		</select>
		<br/>
		Сообщение: <text id="msg">Успешно</text>
		<br/>
		<br/>
		<td id="entext">Шифрование: </td>
		<textarea id="base64en" rows=7 cols=20 oninput="en64(correctText(this.value))">?</textarea>
		<br/>
		<td id="detext">Расшифровка: </td>
		<textarea id="base64de" rows=7 cols=20 oninput="de64(correctText(this.value))">?</textarea>
		</center>
	</body>
</html>