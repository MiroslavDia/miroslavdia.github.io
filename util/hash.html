<!DOCTYPE html>
<html>
	<head>
		<title>Утилиты: хэширование</title>
		<meta charset="UTF-8"></meta>
		<script>
			function getEnding() {
				var i = document.getElementById('end').selectedIndex;
				return i==0?'\n':(i==1?'\r\n':'\r');
			}
			function correctText(text) {
				return text.split('\n').join(getEnding());
			}
			async function _hash(msg, algorithm) {
				return Array.from(new Uint8Array((await crypto.subtle.digest(algorithm, (new TextEncoder().encode(msg)))))).map((b) => b.toString(16).padStart(2, '0')).join('');
			}
			function hash(msg) {
				msg = correctText(msg);
				var r = '?';
				var a = document.getElementById('algorithm').options[document.getElementById('algorithm').selectedIndex].innerHTML;
				r = _hash(msg, a).then(m=>{
					document.getElementById('hash').innerHTML=m;
				});
				return document.getElementById('hash').innerHTML;
			}
			function update() {
				document.getElementById('hash').innerHTML = hash(document.getElementById('input').value);
			}
			window.onload = () => {
				var def = 'Hello, world!';
				document.getElementById('input').value = def;
				update();
			};
		</script>
	</head>
	<body>
		<center>
		<h1>Хэширование</h1>
		Формат строк: <select onchange="update();" id="end">
			<option value="unix" selected>Unix (LF)</option>
			<option value="windows">Windows (CR LF)</option>
			<option value="macintosh">Macintosh (CR)</option>
		</select><br/>
		Алгоритм: <select onchange="update();" id="algorithm">
			<option value="sha1">SHA-1</option>
			<option value="sha256" selected>SHA-256</option>
			<option value="sha384">SHA-384</option>
			<option value="sha512">SHA-512</option>
		</select>
		<br/>
		<br/>
		<td id="entext">Ввод: </td>
		<textarea id="input" rows=7 cols=20 oninput="update();">?</textarea>
		<br/>
		Хэш: <text id="hash">?</text>
		</center>
	</body>
</html>